.page-header
  %h1
    Sign up
    %small create an account to access all our cool features
- html = {:class => 'form-horizontal'}
- url = registration_path(resource_name)
= twitter_bootstrap_form_for resource, {:as => resource_name, :url => url, :html => html} do |f|
  = f.hidden_field :email
  = f.hidden_field :address_1
  = f.hidden_field :address_2
  = f.hidden_field :address_suburb
  = f.hidden_field :address_city
  = f.hidden_field :address_country
  = f.hidden_field :address_postcode
  = f.hidden_field :date_of_birth
  = f.hidden_field :first_name
  = f.hidden_field :last_name
  - resource.completed_signup = true
  = f.hidden_field :completed_signup
  %input{type: 'hidden', value: params[:user][:password], name: 'user[password]'}
  %input{type: 'hidden', value: params[:user][:password_confirmation], name: 'user[password_confirmation]'}
  = f.fieldset do
    .row
      .span6.pet-half
        %h3 Want to use one of our great PetHomeStays?
        %p These details get sent to the PetHomeStay host when you request a booking so they can decide whether or not to accept your pet. Please fill out as much detail as you can.
        .existing-pets.hide{'data-count' => resource.pets.length}
          %table
            %tbody
              - resource.pets.each_with_index do |pet, i|
                - klass = pet.errors.present? ? 'errors' : ''
                %tr{class: klass}
                  - if pet.name.present?
                    %td.name= pet.name
                  - else
                    %td.name Unnamed
                  - if pet.errors.present?
                    %td= link_to_function "Fix errors", "switchPet(#{i});", class: 'btn btn-mini edit-pet'
                  - else
                    %td= link_to_function "Edit this pet", "switchPet(#{i});", class: 'btn btn-mini edit-pet'
          %script#existing-pet-template{type: 'text/x-handlebars-template'}
            %tr
              %td.name {{name}}
              %td= link_to_function "Edit this pet", "switchPet({{index}});", class: 'btn btn-mini edit-pet'
          %hr.span5
        - unless resource.pets.present?
          - pets_class = 'unactivated'
        - resource.pets.build
        .pets{class: pets_class}
          - resource.pets.each do |pet|
            .pet-fields.hide
              = f.fields_for :pets, pet do |f|
                - options = options_for_select([['Dog', :dog], ['Cat', :cat], ['Bird', :bird], ['Fish', :fish], ['Other', :other]], pet.type)
                .pet-type
                  = f.select :type, 'My pet is a', options
                .name
                  = f.text_field :name, "Pet's name"
                = f.text_field :age, "Age (years)"
                .specific.dog
                  - options = options_for_select([['Small (0-15kg)', :small], ['Medium (16-30kg)', :medium], ['Large (31-45kg)', :large], ['Giant (46kg+)', :giant]])
                  = f.select :size, "Size", options
                .specific.dog.cat
                  - options = options_for_select([['Male - desexed', :male_desexed], ['Female - desexed', :female_desexed], ['Male - entire', :male_entire], ['Female - entire', :female_entire]])
                  = f.select :sex, "Sex", options
                  %p Microchipping & council rego not mandatory, however in the event of a lost dog you understand it makes retrevial far easier. PetHomeStay recommends you complete this information as soon as possible.
                  = f.text_field :microchip_number, "Microchip #"
                  = f.text_field :council_number, "Council #"
                  .dislikes
                    = f.label "My pet doesn't like" do |controls|
                      = controls.check_box :dislike_people, 'Other people'
                      = controls.check_box :dislike_animals, 'Other animals'
                      = controls.check_box :dislike_children, 'Children'
                      = controls.check_box :dislike_loneliness, 'Being alone'
                  .explain-dislikes.hide
                    = f.text_area :explain_dislikes, 'Please explain', rows: 4
                  = f.label "My pet has up-to-date" do |controls|
                    = controls.check_box :dislike_people, 'Flea Treatment'
                    = controls.check_box :dislike_animals, 'Vaccinations'
                    = controls.check_box :dislike_children, 'House trained'
          = link_to_function "Add another pet", "addPet()", class: 'btn add-pet'
      - unless resource.homestay.present?
        - resource.build_homestay
        - homestay_class = 'unactivated'
      .span6.divider
        %h3 Love pets and want to make some extra money?
        %p Would you like to help your community with their pets? Maybe make some extra money? Get to know more people in your area? Fill out the form below to get listed on PetHomeStay!
        .span6.homestay-form{class: homestay_class}
          = f.fields_for :homestay do |f|
            = f.label "I would like to make a listing for a (check all that apply)" do |controls|
              = controls.check_box :is_homestay, 'PetHomeStay – you accept other peoples pets for day or overnight homestays at your personal house'
              = controls.check_box :is_sitter, 'Pet Sitting – you are willing to go to other peoples houses and stay there to look after their pets, house & other aspects as needed'
              = controls.check_box :is_services, 'Pet Services – you provide walking, grooming, professional day-care, or other individual or professional pet services except as specified above'
            = f.text_field :title, 'Catchy listing title'
            = f.text_area :description, 'What do you want to tell pet owners about yourself?', class: 'span4', rows: 8
            = f.text_field :years_looking_after_pets, 'Years owning/looking after pets'
            = f.label "I can provide" do |controls|
              = controls.check_box :constant_supervision, '24/7 supervision'
              = controls.check_box :emergency_transport, 'Emergency transport'
            = f.label "I have" do |controls|
              = controls.check_box :first_aid, 'Pet first-aid training'
              = controls.check_box :insurance, 'Professional pet-insurance'
              = controls.check_box :professional_qualification, 'A professional qualification'
            .specific.homestay
              %h3{style: "margin-bottom: 10px;"}Homestay details
              .control-group
                = label_tag :cost_per_night, "Cost per night", class: 'control-label'
                .controls
                  .input-prepend.input-append
                    .add-on $
                    %input.span1#user_homestay_cost_per_night{name: 'user[homestay_attributes][cost_per_night]'}
                    .add-on .00
              %h3{style: "margin-bottom: 10px;"}
                Confirm your PetHomeStay address
              = f.text_field :address_1, 'Street address', value: params[:user][:address_1]
              .control-group
                .controls
                  %input#user_homestay_address_2{name: 'user[homestay_attributes][address_2]', value: params[:user][:address_2]}
              = f.text_field :address_suburb, 'Suburb', value: params[:user][:address_suburb]
              = f.text_field :address_city, 'City', value: params[:user][:address_city]
              = f.country_select :address_country, 'Country', {priority: [params[:user][:address_country]]}
            .specific.sitter
              %h3{style: "margin-bottom: 10px;"} Pet-sitting details
              .control-group
                = label_tag :cost_per_night, "Cost per night", class: 'control-label'
                .controls
                  .input-prepend.input-append
                    .add-on $
                    %input.span1#user_homestay_cost_per_night{name: 'user[homestay_attributes][cost_per_night]'}
                    .add-on .00
            .specific.homestay.sitter
              %label.inline-checkbox
                %input{type: 'checkbox', name: 'user[homestay_attributes][accept_house_rules]'}
                I have read and agree to our
                = link_to 'House Rules', '#'
                for the benefit of the community
            %label.inline-checkbox
              %input{type: 'checkbox', name: 'user[homestay_attributes][accept_terms]'}
              I have read and agree to the PetHomeStay
              = link_to 'terms and conditions', '#'
      .clearfix
    = f.actions do
      = f.submit 'Create my account'
