css:

  .feedback-head {
    cursor : pointer;
  }
  .feedback-body {
    border: 1px solid #ddd;
    border-top: none;
  } 
  .phs-tab-header {
    border-bottom: 1px #ddd solid;  
    margin-left: -20px;
    margin-right: -20px;
  }
  .phs-title {
    font-size: 15px;
    line-height: 20px !important;
    background-color: #f2f2f2;
    color: #434343;
    padding: 20px;
    transition: .3s;
  }
  .phs-title-active {
    font-size: 15px;
    line-height: 20px !important;
    background-color: #5cc1c0;
    color: #ffffff;
    padding: 20px;
    transition: .3s;
  }
  .phs-panel-body {
    margin-left: -20px;
    margin-right: -20px;
    padding: 10px 0 0 0 !important;
  }
  .phs-subtitle {
    background-color: #f2f2f2;
    color: #ababab;
    margin: -10px 0 10px 0;
    padding: 5px;
    text-align: center;
  }
  .phs-rotate {
    transform: rotate(-180deg);
    transition: .3s;
  }
  .phs-reset {
    transform: rotate(0deg);
    transition: .3s;
  }  
  .phs_cb_cont_addon {
    min-width: 200px;
    display: inline-block;
  }
= javascript_include_tag 'dropzone'
= stylesheet_link_tag 'dropzone'
= hidden_field_tag 'redirect_path', params[:redirect_path]
.parent.phs-tab-header
  .panel-heading.feedback-head
    .panel-title.phs-title 
      span.pull-left style="padding-right:10px"
          i.fa.fa-paw 
      span
        ' Step 1 - Your Pet Profile
      span.hidden-sm.hidden-xs style="padding-right:10px; font-size: 8pt"
        'Please complete all fields    
      span.feedback-icon.pull-right 
          i.fa.fa-chevron-down         
  .panel-body.feedback-body 
    = f.label :profile_photo
    #guest_profile_photo_container
      - if @pet.profile_photo?
        = cl_image_tag @pet.profile_photo.public_id, height: 200, angle: :exif, crop: :fill   
    .dropzone id="pet_profile_photo_dropzone"
    - if @pet.new_record?
      = hidden_field_tag "pet[profile_photo]"
    label.hs_mhs_title
    | Pet Name
    = f.input :name, label: false
    label.hs_mhs_title
    | Please Type
    = f.input :pet_type_id, label: false, collection: ReferenceData::PetType.dog_cat_other, as: :radio_buttons, input_html: { class: 'form-radio form-normal form-info collection_rb phs_rb_sp'}, :item_wrapper_class =>'phs_rb_cont'
    label.hs_mhs_title
    | Please specify pet type
    = f.input :other_pet_type, input_html: { id: 'other_pet_type_text_id' }, label: false
    = f.input :breed, label: 'Breed' , collection: DOG_BREEDS, input_html: { class: 'chosen-select', multiple:true, data: { placeholder: 'eg: Beagle' } } 
    = f.input :sex_id, label: false , collection: ReferenceData::Sex.all, as: :radio_buttons,include_blank: false, :item_wrapper_class =>'phs_rb_cont'
    .slider_con
      label.hs_mhs_title style="margin-left:-15px"
        | Pet Size
      = f.input :size_id, label: false, input_html: { class: 'slider', data: { 'slider-id' => 'size', 'slider-min' => 1, 'slider-max' => 4, 'slider-step' => 1, 'slider-value' => f.object.size_id.present? ? f.object.size_id : 1 } }
      label.hs_mhs_title style="margin-left:-15px"
        | Pet Age
      = f.input :pet_age, label: false, input_html: { class: 'slider', data: { 'slider-id' => 'date_of_birth', 'slider-min' => 1, 'slider-max' => 15, 'slider-value' => f.object.try(:pet_age) } }
      label.hs_mhs_title style="margin-left:-15px"
        | Energy Level
      = f.input :energy_level, label: false , input_html: { class: 'slider', data: { 'slider-id' => 'energy_level', 'slider-min' => 1, 'slider-max' => 5, 'slider-step' => 1, 'slider-value' => f.object.energy_level.present? ? f.object.energy_level : 3 } }
    label.hs_mhs_title
      | Personalities
    .phs_help_section
      span This will help the Host take better care of him/her. Please check at least three relevant personalities
    = f.input :personalities, label: false, collection: PERSONALITIES, as: :check_boxes, input_html: { class: 'form-checkbox form-normal form-info collection_cb phs_cb_sp'}, :item_wrapper_class =>'phs_cb_cont phs_cb_cont_addon'
.parent.phs-tab-header
  .panel-heading.feedback-head
    .panel-title.phs-title 
      span.pull-left  style="padding-right:10px"
          i.fa.fa-paw 
      span
        ' Step 2 - Emergency + Medical
      span.hidden-sm.hidden-xs style="padding-right:10px; font-size: 8pt"
        'Optional Information    
      span.feedback-icon.pull-right
          i.fa.fa-chevron-down         
  .panel-body.feedback-body 
    = f.label :extra_photos
    #guest_extra_photos_container
      - if @pet.extra_photos.any?
        .row.mar-top 
          - for photo in @pet.extra_photos
            .col-md-3.col-xs-4.pad-ver.mar-btm id="pet_extra_photos_box_#{photo.id}"
              .panel.widget
                .widget-body.bg-primary.text-center
                  = cl_image_tag photo.public_id, class: "widget-img  img-border-light"
                  a href="#Pet-Profile-Photo" class="remove_pet_extra_photos" data-id="#{photo.id}" data-model-id="#{@pet.id}" data-model-type="Pet" data-scope="extra_photos"
                    | X

    .dropzone id="pet_extra_photos_dropzone"
    - if @pet.new_record?
      = hidden_field_tag "pet[extra_photos][]"
    
    = f.input :emergency_contact_name, label: 'Emergency Contact'
    = f.input :emergency_contact_phone, label: 'Emergency Contact Mobile'
    = f.input :vet_name,  label: 'Vet Surgery'
    = f.input :vet_phone, label: 'Vet Phone'
    = f.input :council_number, label: 'Council Pet Tag'
    = f.input :microchip_number, label: 'Microchip #'
    = f.input :medication, input_html: { rows: 2 }
    label My pet is:
    .checkbox style="margin-left:15px;"
      = f.input :house_trained, label: 'toilet trained', input_html: { class: 'form-checkbox form-normal form-info boolean_cb'}
      = f.input :flea_treated, label: 'flea treated', input_html: { class: 'form-checkbox form-normal form-info boolean_cb'}
      = f.input :vaccinated, label: 'vaccinated', input_html: { class: 'form-checkbox form-normal form-info boolean_cb'}

javascript:
  $('#pet_pet_type_id_1').prop("checked");
  $('#pet_icon_demo_1').css("color", "#ec5c3b");
  $('chosen-select').show();
  $('#other_pet_type_text_id').hide();
  
  $('#pet_pet_type_id_1').click(function() {
    $('#pet_pet_type_id_1').prop("checked");   
    $('.pet_breed').show();
    $('#other_pet_type_text_id').hide();
  });
  $('#pet_pet_type_id_2').click(function() {
    $('#pet_pet_type_id_2').prop("checked"); 
    $('.pet_breed').hide();
    $('#other_pet_type_text_id').hide();
  });
  $('#pet_pet_type_id_5').click(function() {
    $('#pet_pet_type_id_5').prop("checked");
    $('.pet_breed').hide();
    $('#other_pet_type_text_id').show();
  });

  $( ".feedback-body" ).hide();
  $( ".feedback-head" ).click(function(event) {
    var head = $(this).children();
    var icon = $(this).find(".feedback-icon").children();
    var body = $(this).parent().find(".feedback-body");
    if( body.is(":hidden") ) {
      icon.addClass("phs-rotate");
      icon.removeClass("phs-reset");
      head.removeClass("phs-title"); 
      head.addClass("phs-title-active");
      body.slideDown();
    } else {
      icon.removeClass("phs-rotate"); 
      icon.addClass("phs-reset");
      head.removeClass("phs-title-active"); 
      head.addClass("phs-title");
      body.slideUp();
    }
  });

  $("a.remove_pet_extra_photos").click(function(event) {
    event.preventDefault();
    if($(this).attr("data-id") != "" && $(this).attr("data-model-id") != "" && $(this).attr("data-model-type") != "" && confirm('Are you sure?')) {
      photo_id = $(this).attr("data-id");
      $.ajax({
        url: '/remove_uploads',
        type: 'DELETE',
        data: "id=" + $(this).attr("data-id") +
              "&model_type=" + $(this).attr("data-model-type") +
              "&model_id=" + $(this).attr("data-model-id") +
              "&scope=" + $(this).attr("data-scope"),
        success: function(result) {
          if(result.status == "success"){
            $("div#pet_extra_photos_box_" + photo_id ).remove();
          } else {
            alert("Sorry Something went wrong!")
          }
        }
      });
    }
  });

  var profile_photo = [];
  $(document).ready(function () {
    $("#pet_profile_photo_dropzone").dropzone({
      url: "/photo_uploads",
      paramName: "photo",
      previewsContainer: "#guest_profile_photo_container" ,
      acceptedFiles: 'image/*',
      maxFilesize: 2,
      maxFiles: 1,
      addRemoveLinks: true,
      maxfilesexceeded: function () {
        alert('Max File updloaded');
      },
      sending: function (file, xhr, formData) {
        formData.append("authenticity_token", "#{form_authenticity_token}");
        formData.append("attachinariable_type", "#{@pet.class.name}");
        formData.append("attachinariable_id", "#{@pet.id}");
        formData.append("attachinary_scope", "profile_photo");
      },
      success: function (file, response) {
        profile_photo = [response]
        #{{ "$('#pet_profile_photo').val(JSON.stringify(profile_photo));" if @pet.new_record? }}
        file.previewElement.classList.add("dz-success");
        file.previewElement.classList.add("public_id" + response.public_id);
      },
      removedfile: function(file) {
        classes = file.previewElement.classList;
        for(i = 0; i < classes.length; i++){
          if( classes[i].match("public_id") == "public_id" ){
            file_id = classes[i].replace("public_id", "");
            for(j=0; j<profile_photo.length; j++){
              if(file_id == profile_photo[j].public_id){
                profile_photo.splice(j, 1);
                #{{ "$('#pet_profile_photo').val(JSON.stringify(profile_photo));" if @pet.new_record? }}
                break;
              }
            }
            $.ajax({
              url: '/remove_uploads_with_public_id',
              type: 'DELETE',
              data: "public_id=" + file_id,
              success: function(result) {}
            });
            var _ref;
            if ((_ref = file.previewElement) != null) {
              _ref.parentNode.removeChild(file.previewElement);
            }
            return this._updateMaxFilesReachedClass();
            break;
          }
        }
      }
    });
  });
  
  var extra_photos = [];
  $(document).ready(function () {
    $("#pet_extra_photos_dropzone").dropzone({
      url: "/photo_uploads",
      paramName: "photo",
      //previewsContainer: "#guest_extra_photos_container",
      acceptedFiles: 'image/*',
      maxFilesize: 2,
      maxFiles: 10,
      addRemoveLinks: true,
      maxfilesexceeded: function () {
        alert('Max File updloaded');
      },
      sending: function (file, xhr, formData) {
        formData.append("authenticity_token", "#{form_authenticity_token}");
        formData.append("attachinariable_type", "#{@pet.class.name}");
        formData.append("attachinariable_id", "#{@pet.id}");
        formData.append("attachinary_scope", "extra_photos");
      },
      success: function (file, response) {
        extra_photos.push(response)
        #{{ "$('#pet_extra_photos_').val(JSON.stringify(extra_photos));" if @pet.new_record? }}
        file.previewElement.classList.add("dz-success");
        file.previewElement.classList.add("public_id" + response.public_id);
      },
      removedfile: function(file) {
        classes = file.previewElement.classList;
        for(i = 0; i < classes.length; i++){
          if( classes[i].match("public_id") == "public_id" ){
            file_id = classes[i].replace("public_id", "");
            for(j=0; j<extra_photos.length; j++){
              if(file_id == extra_photos[j].public_id){
                extra_photos.splice(j, 1);
                #{{ "$('#pet_extra_photos_').val(JSON.stringify(extra_photos));" if @pet.new_record? }}
                break;
              }
            }
            $.ajax({
              url: '/remove_uploads_with_public_id',
              type: 'DELETE',
              data: "public_id=" + file_id,
              success: function(result) {}
            });
            var _ref;
            if ((_ref = file.previewElement) != null) {
              _ref.parentNode.removeChild(file.previewElement);
            }
            return this._updateMaxFilesReachedClass();
            break;
          }
        }
      }
    });
  });
coffee:
  $('.pet_size_id .slider').slider
    formatter: (size_id) ->
      switch size_id
        when 1 then 'under 15kg'
        when 2 then '16-30kg'
        when 3 then '31-45kg'
        when 4 then '46kg+'
        else 'invalid value'
  $('.pet_energy_level .slider').slider
    formatter: (energy_id) ->
      switch energy_id
        when 1 then 'low'
        when 2 then 'low medium'
        when 3 then 'medium'
        when 4 then 'high medium'
        when 5 then 'high'
        else 'invalid value'
  $('.pet_pet_age .slider').slider
    formatter: (age) ->
      switch age
        when 1  then 'under 18 months'
        when 15 then '15+ years'
        else "#{age} years old"
  $('.pet_profile_photo .attachinary-input').attachinary
    template: """
      <table class="table table-hover">
        <tr>
          <th>Thumbnail</th>
          <th>Preview</th>
          <th>Action</th>
        </tr>
        <% for(var i = 0; i < files.length; i++){ %>
          <tr>
          <% if(files[i].resource_type == "raw") { %>
            <td colspan="3">
              <div class="raw-file"></div>
            </td>
          <% } else { %>
            <td>
              <img
                src="<%= $.cloudinary.url(files[i].public_id, { "version": files[i].version, "format": 'png', "crop": 'fill', "width": 50, "height": 50 }) %>"
                alt="" width="50" height="50" />
            </td>
            <td>
              <img
                src="<%= $.cloudinary.url(files[i].public_id, { "version": files[i].version, "format": 'png', "crop": 'thumb', "width": 50, "height": 50, "radius": "max" }) %>"
                alt="" width="50" height="50" />
            </td>
            <td>
              <a href="#" ><i class="fa fa-trash-o pet-trash" data-remove="<%= files[i].public_id %>"></i></a>
            </td>
          <% } %>
            </td>
          </tr>
        <% } %>
      </table class="table">
    """
  $('.pet_extra_photos .attachinary-input').attachinary
    template: """
      <table class="table table-hover">
        <tr>
          <th>Thumbnail</th>
          <th>Action</th>
        </tr>
        <% for(var i = 0; i < files.length; i++){ %>
          <tr>
          <% if(files[i].resource_type == "raw") { %>
            <td colspan="3">
              <div class="raw-file"></div>
            </td>
          <% } else { %>
            <td>
              <img
                src="<%= $.cloudinary.url(files[i].public_id, { "version": files[i].version, "format": 'png', "crop": 'fit', "width": 75}) %>"
                alt=""/>
            </td>
            <td>
              <a href="#"><i class="fa fa-trash-o pet-trash" data-remove="<%= files[i].public_id %>"></i></a>
            </td>
          <% } %>
            </td>
          </tr>
        <% } %>
      </table class="table">
    """
  $('.chosen-select').chosen
    allow_single_deselect: true
    no_results_text: 'No results matched'
    width: '200px'
