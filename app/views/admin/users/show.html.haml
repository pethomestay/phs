%p#notice= notice

%dl.dl-horizontal
  %dt Name
  %dd= @user.name
  %dt Joined
  %dd= l @user.created_at
  %dt Email
  %dd= @user.email
  %dt Homestay
  %dd= @user.homestay.present? ? @user.homestay.title : 'no homestay'
  %dt Pets
  %dd= @user.pets.count
  %dt Date of birth
  %dd= @user.date_of_birth
  - if not @user.provider.nil?
    - if not @user.facebook_location.nil?
      %dt Facebook Location
      %dd= @user.facebook_location
    %dt Age range minimum
    %dd= @user.age_range_min
    -if not @user.age_range_max.nil?
      %dt Age range maximum
      %dd= @user.age_range_max
  %dt Phone
  %dd= @user.phone_number.present? ? @user.phone_number : '-'
  %dt Mobile
  %dd= @user.mobile_number.present? ? @user.mobile_number : '-'
  %dt Address
  %dd
    = @user.address_1
    = @user.address_2
    %br
    = "#{@user.address_suburb}, #{@user.address_postcode}"
  - if @user.unavailable_dates.any?
    %dt Unavailable dates
    - @user.unavailable_dates.sort_by!(&:date).each_with_index do |unavailable, index|
      - next if unavailable.date < Date.today
      %dd
        = unavailable.date.to_date.strftime("%A, %d/%m/%Y")
  %dt Coupons
  - if @user.owned_coupons.any?
    %dd= @user.owned_coupons.collect(&:code).join("<br>").html_safe
.control-group
  %label Unavailable Dates
  .controls
    From
    %input#from{ type: 'text' }
    to
    %input#to{ type: 'text' }
    %button.btn.btn-primary#mark-unavailable{ 'data-user-id' => @user.id } Mark Unavailable
%br

= link_to 'Edit', edit_admin_user_path(@user), class: 'btn btn-primary'
= link_to 'Back to user list', admin_users_path(letter: 'Z'), class: 'btn'

:coffee
  $ ->
    # Enable datepicker
    $from = $('#from')
    $to = $('#to')
    $from.datepicker(
      format: 'dd/mm/yyyy'
      startDate: '0d'
      autoclose: true # False by default
    ).data('datepicker')
    $to.datepicker(
      format: 'dd/mm/yyyy'
      startDate: '0d'
      autoclose: true # False by default
    ).data('datepicker')

    $('#mark-unavailable').on 'click', ->
      $.ajax '/unavailable_dates',
        type: 'POST'
        data:
          user_id: $('#mark-unavailable').data('user-id')
          from: $from.val()
          to: $to.val()
        success: ->
          alert 'Success'
